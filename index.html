<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel - Monitoramento AGSUS</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: #f8fafc; }
        header { background: #002d57; color: white; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; height: 60px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); flex-shrink: 0; }
        
        .nav-tabs { display: flex; list-style: none; margin: 0; padding: 0; height: 100%; }
        .nav-tabs li { display: flex; align-items: center; padding: 0 20px; cursor: pointer; color: #cbd5e0; border-bottom: 4px solid transparent; transition: 0.3s; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .nav-tabs li:hover { background: rgba(255,255,255,0.05); color: white; }
        .nav-tabs li.active { border-bottom: 4px solid #3b82f6; color: white; background: rgba(255,255,255,0.1); font-weight: bold; }

        .content-page { display: none; flex: 1; overflow: hidden; position: relative; }
        .content-page.active { display: flex; }

        #map { flex: 2; background: #cbd5e0; position: relative; }
        #sidebar-resumo { flex: 1; min-width: 420px; background: white; overflow-y: auto; padding: 15px; border-left: 1px solid #e2e8f0; padding-bottom: 60px; }

        /* Estilo do Popup no Mapa */
        .custom-popup .leaflet-popup-content-wrapper { background: #002d57; color: #fff; border-radius: 8px; padding: 5px; }
        .custom-popup .leaflet-popup-tip { background: #002d57; }
        .popup-data { font-size: 12px; line-height: 1.6; }
        .popup-title { font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.2); margin-bottom: 5px; padding-bottom: 2px; font-size: 14px; }

        /* Legenda do Mapa com status integrados */
        .map-legend-container {
            position: absolute;
            bottom: 60px;
            left: 10px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 280px;
        }
        
        .map-legend, .status-box {
            background: white; 
            padding: 10px; 
            border-radius: 5px; 
            box-shadow: 0 1px 5px rgba(0,0,0,0.4); 
            line-height: 18px; 
            color: #333;
            backdrop-filter: blur(2px);
        }
        
        .status-box {
            padding: 8px 10px;
        }
        
        .legend-title {
            font-weight: 600;
            font-size: 12px;
            color: #002d57;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-item { display: flex; align-items: center; margin-bottom: 4px; font-size: 11px; }
        .legend-color { width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; border: 1px solid #666; flex-shrink: 0; }
        
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 5px;
        }
        
        .status-section {
            font-size: 11px;
        }
        
        .status-row {
            display: flex;
            align-items: center;
            margin-bottom: 3px;
            justify-content: space-between;
        }
        
        .status-info {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-count {
            font-weight: 600;
            font-size: 11px;
            color: #0f172a;
        }
        
        .status-label {
            font-size: 10px;
            color: #475569;
        }

        /* Caixas de Texto (Crit√©rios) */
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .info-box { background: #f1f5f9; padding: 10px; border-radius: 6px; border-left: 4px solid #002d57; font-size: 11px; }
        .info-box h4 { margin: 0 0 5px 0; font-size: 12px; color: #002d57; }
        .info-box ul { margin: 0; padding-left: 15px; }

        #page-competencias { flex-direction: column; padding: 25px; background: white; overflow-y: auto; }
        .table-wrapper { width: 100%; overflow-x: auto; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 60px; }
        
        table { width: 100%; border-collapse: collapse; font-size: 11px; }
        th { background: #f8fafc; color: #475569; padding: 10px; text-align: left; position: sticky; top: 0; border-bottom: 2px solid #e2e8f0; z-index: 10; cursor: pointer; transition: background 0.2s; }
        th:hover { background: #e2e8f0; }
        th::after { content: ' ‚Üï'; font-size: 10px; color: #94a3b8; margin-left: 5px; }
        
        td { padding: 8px; border-bottom: 1px solid #f1f5f9; }

        .nota-badge { display: inline-block; width: 28px; text-align: center; padding: 2px 0; border-radius: 4px; color: white; font-weight: bold; }
        .label-fixo-cidade { background: transparent; border: none; box-shadow: none; font-weight: 800; color: #0f172a; font-size: 10px; text-shadow: 1px 1px 2px white; pointer-events: none; }

        .footer-link { position: fixed; bottom: 0; left: 0; right: 0; height: 40px; background: rgba(255, 255, 255, 0.95); border-top: 1px solid #e2e8f0; display: flex; align-items: center; justify-content: center; z-index: 2000; font-size: 12px; backdrop-filter: blur(5px); }
        .footer-link a { color: #002d57; text-decoration: none; font-weight: 600; }
    </style>
</head>
<body>

<header>
    <div style="font-weight: bold; font-size: 18px;">AGSUS - Gest√£o de Compet√™ncias</div>
    <ul class="nav-tabs">
        <li onclick="openTab('page-mapa', this)" class="active">Vis√£o Geral</li>
        <li onclick="openTab('page-competencias', this)">Avalia√ß√£o Detalhada</li>
    </ul>
</header>

<div id="page-mapa" class="content-page active">
    <div id="map"></div>
    <div id="sidebar-resumo">
        <div class="info-grid">
            <div class="info-box">
                <h4>Crit√©rios Avaliados</h4>
                <ul>
                    <li>Gest√£o de processos</li>
                    <li>Gest√£o de Projetos</li>
                    <li>Governan√ßa e conformidade</li>
                    <li>Qualidade no SEI</li>
                    <li>Decis√£o baseada em evid√™ncia</li>
                    <li>Institucional</li>
                    <li>Comunica√ß√£o</li>
                </ul>
            </div>
            <div class="info-box">
                <h4>Escala de Avalia√ß√£o</h4>
                <ul>
                    <li>0: Desconhece</li>
                    <li>1: Conhece Termos</li>
                    <li>2: Aplica com erros</li>
                    <li>3: Aplica corretamente</li>
                    <li>4: Aplica e orienta</li>
                    <li>5: Melhora o processo</li>
                </ul>
            </div>
        </div>

        <h3 style="margin-top:0">Consolidado por Distrito</h3>
        <table id="tabela-resumo">
            <thead>
                <tr>
                    <th onclick="sortTable(0, 'tabela-resumo')">Unidade</th>
                    <th onclick="sortTable(1, 'tabela-resumo')">Nota Chefe</th>
                    <th onclick="sortTable(2, 'tabela-resumo')">Nota Asse.</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div id="page-competencias" class="content-page">
    <h3 style="margin-top:0">Avalia√ß√£o Individual de Compet√™ncias</h3>
    <div class="table-wrapper">
        <table id="tabela-detalhada">
            <thead>
                <tr>
                    <th onclick="sortTable(0, 'tabela-detalhada')">Nome</th>
                    <th onclick="sortTable(1, 'tabela-detalhada')">Unidade</th>
                    <th onclick="sortTable(2, 'tabela-detalhada')">Fun√ß√£o</th>
                    <th onclick="sortTable(3, 'tabela-detalhada')">Proc.</th>
                    <th onclick="sortTable(4, 'tabela-detalhada')">Proj.</th>
                    <th onclick="sortTable(5, 'tabela-detalhada')">Gov.</th>
                    <th onclick="sortTable(6, 'tabela-detalhada')">SEI</th>
                    <th onclick="sortTable(7, 'tabela-detalhada')">Decis.</th>
                    <th onclick="sortTable(8, 'tabela-detalhada')">Inst.</th>
                    <th onclick="sortTable(9, 'tabela-detalhada')">Comu.</th>
                    <th onclick="sortTable(10, 'tabela-detalhada')">M√©dia</th>
                    <th onclick="sortTable(11, 'tabela-detalhada')">Observa√ß√µes</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<footer class="footer-link">
    <a href="https://docs.google.com/spreadsheets/d/1EWxmHVDE_Yp_DIGZ-jT9Z1BZ3KVrxM23XsxZgz4L0X0/edit#gid=0" target="_blank">
        üîó Clique aqui para acessar a Base de Dados Completa
    </a>
</footer>

<script>
    function getColor(v) {
        if (v < 2.0) return "#991b1b";      
        if (v < 3.5) return "#ca8a04";      
        return "#1d4ed8";                   
    }

    function getStatus(v) {
        if (v < 2.0) return { nome: "Avaliar", cor: "#991b1b" };
        if (v < 3.5) return { nome: "Capacitar", cor: "#ca8a04" };
        return { nome: "Satisfat√≥rio", cor: "#1d4ed8" };
    }

    // [Dados resumoMapa mantidos para funcionamento...]
    const resumoMapa = [
    { n: "Macei√≥", lat: -9.66, lng: -35.73, c: 4.3, a: 2.9 },
    { n: "Altamira", lat: -3.20, lng: -52.20, c: 4.6, a: 3.9 },
    { n: "Cruzeiro do Sul", lat: -7.63, lng: -72.66, c: 3.1, a: 3.1 },
    { n: "S√£o Gabriel", lat: -0.13, lng: -67.08, c: 4.0, a: 2.4 },
    { n: "Rio Branco", lat: -9.97, lng: -67.81, c: 2.7, a: 2.7 },
    { n: "Tabatinga", lat: -4.23, lng: -69.93, c: 4.9, a: 1.9 },
    { n: "Macap√°", lat: 0.03, lng: -51.06, c: 4.0, a: 4.0 },
    { n: "S. F√©lix Araguaia", lat: -11.61, lng: -50.67, c: 2.0, a: 4.0 },
    { n: "Salvador", lat: -12.97, lng: -38.50, c: 4.3, a: 4.3 }, // Consolidado (M√©dia Regional/Distrital)
    { n: "Fortaleza", lat: -3.71, lng: -38.54, c: 4.3, a: 3.7 },
    { n: "Cuiab√°", lat: -15.60, lng: -56.09, c: 4.0, a: 3.0 },
    { n: "Bel√©m", lat: -1.45, lng: -48.49, c: 3.1, a: 0.0 },
    { n: "Florian√≥polis", lat: -27.59, lng: -48.54, c: 3.9, a: 0.0 },
    { n: "Curitiba", lat: -25.42, lng: -49.27, c: 4.0, a: 4.0 },
    { n: "Col√≠der", lat: -10.81, lng: -55.45, c: 4.0, a: 3.0 },
    { n: "Reden√ß√£o", lat: -8.02, lng: -50.03, c: 3.0, a: 3.0 },
    { n: "Leste Roraima", lat: 2.82, lng: -60.67, c: 4.0, a: 4.0 },
    { n: "Manaus", lat: -3.11, lng: -60.02, c: 4.9, a: 0.6 },
    { n: "S√£o Lu√≠s", lat: -2.53, lng: -44.30, c: 4.3, a: 4.1 },
    { n: "Campo Grande", lat: -20.44, lng: -54.64, c: 4.1, a: 0.0 },
    { n: "L√°brea", lat: -7.25, lng: -64.79, c: 4.0, a: 4.0 },
    { n: "Tef√©", lat: -3.35, lng: -64.71, c: 4.9, a: 4.7 },
    { n: "Gov. Valadares", lat: -18.85, lng: -41.94, c: 4.0, a: 4.0 },
    { n: "Parintins", lat: -2.62, lng: -56.73, c: 4.0, a: 4.0 },
    { n: "Recife", lat: -8.05, lng: -34.88, c: 3.6, a: 3.7 },
    { n: "Porto Velho", lat: -8.76, lng: -63.90, c: 1.1, a: 1.1 },
    { n: "Jo√£o Pessoa", lat: -7.11, lng: -34.86, c: 4.1, a: 4.1 },
    { n: "Bras√≠lia", lat: -15.79, lng: -47.88, c: 3.0, a: 3.0 }, // Referente ao Centro-Oeste
    { n: "Boa Vista", lat: 2.81, lng: -60.67, c: 5.0, a: 4.3 }, // M√©dia entre Regional e Distrital
    { n: "Itaituba", lat: -4.27, lng: -55.98, c: 5.0, a: 3.4 },
    { n: "Palmas", lat: -10.18, lng: -48.33, c: 0.0, a: 4.0 },
    { n: "Atalaia Norte", lat: -4.37, lng: -70.19, c: 0.0, a: 2.9 },
    { n: "Cacoal", lat: -11.43, lng: -61.44, c: 2.0, a: 0.1 },
    { n: "Barra Gar√ßas", lat: -15.89, lng: -52.25, c: 4.1, a: 4.0 },
    { n: "Canarana", lat: -13.55, lng: -52.27, c: 4.1, a: 4.1 },
    { n: "S√£o Paulo", lat: -23.55, lng: -46.63, c: 3.6, a: 0.0 }
];

    // [Dados detComp mantidos...]
    const detComp = [
    { n: "Maynamy Jose Santana Da Silva", u: "Macei√≥", f: "Chefe", c: [3, 4, 4, 4, 5, 5, 5], med: 4.3, obs: "" },
    { n: "Manoel Mendonca De Farias Neto", u: "Macei√≥", f: "Assessor", c: [2, 2, 3, 3, 3, 3, 4], med: 2.9, obs: "" },
    { n: "Flavio Moreira De Paula", u: "Altamira", f: "Chefe", c: [4, 4, 5, 4, 5, 5, 5], med: 4.6, obs: "" },
    { n: "Aline Cunha Gomes", u: "Altamira", f: "Assessor", c: [3, 4, 4, 4, 4, 4, 4], med: 3.9, obs: "" },
    { n: "Ireni Herculano Uchoa Moura", u: "Cruzeiro do Sul", f: "Chefe", c: [4, 3, 3, 3, 3, 3, 3], med: 3.1, obs: "" },
    { n: "Quedma Da Cruz Oliveira", u: "Cruzeiro do Sul", f: "Assessor", c: [4, 3, 3, 3, 3, 3, 3], med: 3.1, obs: "" },
    { n: "Raylene Andrade Oliveira", u: "S√£o Gabriel", f: "Chefe", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Carlos Savio Da Silva Ferraz", u: "S√£o Gabriel", f: "Assessor", c: [1, 2, 2, 2, 4, 4, 2], med: 2.4, obs: "" },
    { n: "Raquel Pass√≠fico da Rocha", u: "Rio Branco", f: "Chefe", c: [3, 3, 3, 2, 3, 3, 2], med: 2.7, obs: "" },
    { n: "Celino Avelino Batista Apurina", u: "Rio Branco", f: "Assessor", c: [2, 3, 3, 3, 3, 3, 2], med: 2.7, obs: "" },
    { n: "Cristiane Ferreira da Silva", u: "Tabatinga", f: "Chefe", c: [4, 5, 5, 5, 5, 5, 5], med: 4.9, obs: "" },
    { n: "Francisco Macedo Mo√ßambite", u: "Tabatinga", f: "Assessor", c: [2, 2, 2, 2, 1, 2, 2], med: 1.9, obs: "Assessor com tempo de escrit√≥rio e ainda n√£o entende o seu papel institucional, ainda se posiciona como Condisi. N√£o possui esp√≠rito de colabora√ß√£o com a chefe do escrit√≥rio." },
    { n: "Argemiro Falcao Junior", u: "Macap√°", f: "Chefe", c: [4, 4, 4, 3, 4, 4, 5], med: 4.0, obs: "" },
    { n: "Kutanan Waiapi Waiana", u: "Macap√°", f: "Assessor", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Samuel Yriwerana Karaja", u: "S. F√©lix Araguaia", f: "Chefe", c: [2, 2, 2, 2, 2, 2, 2], med: 2.0, obs: "" },
    { n: "Ohori Haritxana De Farias Karaja", u: "S. F√©lix Araguaia", f: "Assessor", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Andressa Carvalho Santos", u: "Salvador", f: "Chefe", c: [4, 4, 4, 4, 5, 4, 5], med: 4.3, obs: "" },
    { n: "Ana Thereza Nunes Campos", u: "Salvador", f: "Assessor", c: [4, 4, 4, 4, 5, 4, 5], med: 4.3, obs: "" },
    { n: "Joao Paulo Vieira Neto", u: "Fortaleza", f: "Chefe", c: [4, 4, 4, 4, 5, 4, 5], med: 4.3, obs: "" },
    { n: "Raimundo Sebasti√£o Rodrigues Neto", u: "Fortaleza", f: "Assessor", c: [3, 3, 3, 4, 4, 4, 5], med: 3.7, obs: "" },
    { n: "Lib√©rio Uiagumeareu", u: "Cuiab√°", f: "Chefe", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Vanessa Ta√≠s de Santana Barros", u: "Cuiab√°", f: "Assessor", c: [3, 3, 3, 3, 3, 3, 3], med: 3.0, obs: "" },
    { n: "Ronaldo Ramos Nunes", u: "Bel√©m", f: "Chefe", c: [3, 3, 3, 3, 3, 4, 3], med: 3.1, obs: "" },
    { n: "Ednaldo Tembe", u: "Bel√©m", f: "Assessor", c: [0, 0, 0, 0, 0, 0, 0], med: 0.0, obs: "O Ednaldo n√£o participa das reuni√µes pontos de controle. N√£o h√° evid√™ncias de cumprimento integral das atividades." },
    { n: "Rildo Mendes", u: "Florian√≥polis", f: "Chefe", c: [4, 4, 4, 3, 4, 4, 4], med: 3.9, obs: "" },
    { n: "Matavitsa Kena Waura Txucarram√£e", u: "Col√≠der", f: "Chefe", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Kadjure Metyktire", u: "Col√≠der", f: "Assessor", c: [3, 3, 3, 3, 3, 3, 3], med: 3.0, obs: "" },
    { n: "Tania Paiakan Kaiap√≥", u: "Reden√ß√£o", f: "Chefe", c: [3, 3, 3, 3, 3, 3, 3], med: 3.0, obs: "" },
    { n: "Mayara de Assis Cardoso", u: "Reden√ß√£o", f: "Assessor", c: [3, 3, 3, 3, 3, 3, 3], med: 3.0, obs: "" },
    { n: "Zenaide Peres de Sousa", u: "Leste Roraima", f: "Chefe", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Jackson Nascimento Pereira", u: "Leste Roraima", f: "Assessor", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Placida Beatriz Osorio", u: "Curitiba", f: "Chefe", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Claudia Leite Vieira", u: "Manaus", f: "Chefe", c: [5, 4, 5, 5, 5, 5, 5], med: 4.9, obs: "" },
    { n: "Kleuton Lopes De Matos", u: "Manaus", f: "Assessor", c: [1, 1, 1, 0, 0, 1, 0], med: 0.6, obs: "Ausente em todas as tratativas administrativas." },
    { n: "Solange Pereira Costa", u: "S√£o Lu√≠s", f: "Chefe", c: [4, 4, 4, 4, 5, 4, 5], med: 4.3, obs: "" },
    { n: "Suellen Viana Marize Lopes", u: "S√£o Lu√≠s", f: "Assessor", c: [4, 4, 4, 4, 4, 4, 5], med: 4.1, obs: "" },
    { n: "Danilo Giupato", u: "Campo Grande", f: "Chefe", c: [4, 4, 4, 4, 4, 4, 5], med: 4.1, obs: "" },
    { n: "Moacyr Ca√±izo de Brito Filho", u: "L√°brea", f: "Chefe", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Raimunda Pereira Lima", u: "L√°brea", f: "Assessor", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Luiz Carlos Ferreira Penha", u: "Tef√©", f: "Chefe", c: [5, 5, 5, 4, 5, 5, 5], med: 4.9, obs: "" },
    { n: "F√°bio Pereira dos Santos", u: "Tef√©", f: "Assessor", c: [5, 5, 5, 4, 5, 5, 4], med: 4.7, obs: "" },
    { n: "Ronaldo dos Santos Pena", u: "Gov. Valadares", f: "Chefe", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Roberth Reytmann da Silva", u: "Gov. Valadares", f: "Assessor", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Erlisson dos Santos Cidade", u: "Parintins", f: "Chefe", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Andrey Thomassen Corr√™a", u: "Parintins", f: "Assessor", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Ailson dos Santos", u: "Recife", f: "Chefe", c: [2, 4, 4, 1, 4, 5, 5], med: 3.6, obs: "" },
    { n: "Jacqueline da Silva Targino Soares", u: "Recife", f: "Assessor", c: [4, 3, 4, 4, 3, 4, 4], med: 3.7, obs: "" },
    { n: "Josaf√° Piauhy Matreiro", u: "Porto Velho", f: "Chefe", c: [2, 1, 3, 2, 0, 0, 0], med: 1.1, obs: "" },
    { n: "Domingos S√°vio F. de Ara√∫jo", u: "Porto Velho", f: "Assessor", c: [2, 1, 3, 2, 0, 0, 0], med: 1.1, obs: "" },
    { n: "Lilian Cristina P. da Cunha Lima", u: "Jo√£o Pessoa", f: "Chefe", c: [4, 4, 4, 4, 4, 4, 5], med: 4.1, obs: "" },
    { n: "Robson Cassiano Soares", u: "Jo√£o Pessoa", f: "Assessor", c: [4, 4, 4, 3, 4, 5, 5], med: 4.1, obs: "" },
    { n: "Guilherme Oliveira Chaves", u: "Centro-Oeste", f: "Coordenador Regional", c: [3, 3, 3, 3, 3, 3, 3], med: 3.0, obs: "" },
    { n: "Nadja Almeida Guimar√£es", u: "Salvador", f: "Coordenador Regional", c: [5, 5, 5, 3, 5, 5, 5], med: 4.7, obs: "" },
    { n: "Ara Josefina Silveira Brasil", u: "Salvador", f: "Assessor", c: [3, 4, 3, 3, 4, 4, 4], med: 3.6, obs: "" },
    { n: "Gerlane Albuquerque dos Santos", u: "Recife", f: "Coordenador Regional", c: [3, 4, 4, 3, 4, 4, 4], med: 3.7, obs: "" },
    { n: "Priscila da Silva Ramos", u: "Recife", f: "Assessor", c: [3, 3, 3, 3, 3, 3, 3], med: 3.0, obs: "" },
    { n: "Eduardo Funchal", u: "Curitiba", f: "Coordenador Regional", c: [4, 4, 4, 3, 4, 5, 5], med: 4.1, obs: "" },
    { n: "Dione da Concei√ß√£o Garcia", u: "Curitiba", f: "Assessor", c: [4, 4, 4, 3, 4, 5, 4], med: 4.0, obs: "" },
    { n: "Rosenilda Aparecida da Silva", u: "S√£o Paulo", f: "Coordenador Regional", c: [3, 4, 4, 2, 4, 4, 4], med: 3.6, obs: "" },
    { n: "Cleidiane Carvalho Ribeiro", u: "Boa Vista", f: "Coordenador Regional", c: [5, 5, 5, 5, 5, 5, 5], med: 5.0, obs: "" },
    { n: "Jesiel Rodrigues", u: "Itaituba", f: "Chefe", c: [5, 5, 5, 5, 5, 5, 5], med: 5.0, obs: "" },
    { n: "Sindomar Waru Munduruku", u: "Itaituba", f: "Assessor", c: [3, 3, 3, 2, 4, 4, 5], med: 3.4, obs: "" },
    { n: "Avanilson Ijoraru Dias Aires Karaja", u: "Palmas", f: "Chefe", c: [0, 0, 0, 0, 0, 0, 0], med: 0.0, obs: "N√£o participa dos pontos de controle." },
    { n: "Eliene Da Silva Machado", u: "Palmas", f: "Assessor", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Ricardo Cavalcante Barbosa Junior", u: "Atalaia do Norte", f: "Chefe", c: [0, 0, 0, 0, 0, 0, 0], med: 0.0, obs: "N√£o contratado." },
    { n: "Analimar Dias Castelo Branco", u: "Atalaia do Norte", f: "Assessor", c: [3, 3, 3, 3, 2, 2, 4], med: 2.9, obs: "" },
    { n: "Juliana Rodrigues", u: "Cacoal", f: "Chefe", c: [2, 2, 2, 3, 3, 2, 0], med: 2.0, obs: "" },
    { n: "Rog√©rio Soares Chagas", u: "Cacoal", f: "Assessor", c: [0, 0, 1, 0, 0, 0, 0], med: 0.1, obs: "" },
    { n: "Jorge Alberto Santos Temb√©", u: "Barra dos Gar√ßas", f: "Chefe", c: [4, 4, 4, 4, 4, 4, 5], med: 4.1, obs: "" },
    { n: "Carlos Henrique Orebewe da Silva", u: "Barra dos Gar√ßas", f: "Assessor", c: [4, 4, 4, 4, 4, 4, 4], med: 4.0, obs: "" },
    { n: "Gilmar Wagner", u: "Canarana", f: "Chefe", c: [4, 4, 4, 4, 4, 4, 5], med: 4.1, obs: "" },
    { n: "Helio Roberto Andersson Ramos", u: "Canarana", f: "Assessor", c: [4, 4, 4, 4, 4, 4, 5], med: 4.1, obs: "" },
    { n: "Maria Eliane Gon√ßalves da Silva", u: "Boa Vista", f: "Chefe", c: [4, 4, 4, 5, 4, 4, 5], med: 4.3, obs: "" },
    { n: "Ana Patricia Santana de S. Moreira", u: "Boa Vista", f: "Assessor", c: [4, 4, 4, 5, 4, 4, 5], med: 4.3, obs: "" }
];

    // Fun√ß√£o para calcular percentuais
    function calcularPercentuais() {
        const chefes = detComp.filter(d => d.f.includes("Chefe") || d.f.includes("Coordenador Regional"));
        const assessores = detComp.filter(d => d.f.includes("Assessor"));
        
        const statusTypes = [
            { nome: "Satisfat√≥rio", min: 3.5, max: 5.0, cor: "#1d4ed8" },
            { nome: "Capacitar", min: 2.0, max: 3.49, cor: "#ca8a04" },
            { nome: "Avaliar", min: 0, max: 1.99, cor: "#991b1b" }
        ];
        
        function calcularParaGrupo(grupo) {
            const result = {};
            const total = grupo.length;
            
            statusTypes.forEach(status => {
                const count = grupo.filter(d => d.med >= status.min && d.med <= status.max).length;
                const percent = total > 0 ? ((count / total) * 100).toFixed(1) : "0.0";
                result[status.nome] = { percent, count, total, cor: status.cor };
            });
            
            return result;
        }
        
        return {
            chefes: calcularParaGrupo(chefes),
            assessores: calcularParaGrupo(assessores)
        };
    }
    
    // Fun√ß√£o para criar a legenda com status integrados
    function criarLegendaComStatus() {
        const container = L.DomUtil.create('div', 'map-legend-container');
        
        // Legenda principal
        const legendDiv = L.DomUtil.create('div', 'map-legend');
        legendDiv.innerHTML = `
            <div class="legend-title">üìä Status de Compet√™ncia</div>
            <div class="legend-item"><div class="legend-color" style="background:#1d4ed8"></div> Satisfat√≥rio (>= 3.5)</div>
            <div class="legend-item"><div class="legend-color" style="background:#ca8a04"></div> Capacitar (2.0 - 3.4)</div>
            <div class="legend-item"><div class="legend-color" style="background:#991b1b"></div> Avaliar (< 2.0)</div>
        `;
        
        container.appendChild(legendDiv);
        
        // Calcular percentuais
        const percentuais = calcularPercentuais();
        
        // Caixa de status dos chefes e assessores
        const statusDiv = L.DomUtil.create('div', 'status-box');
        statusDiv.innerHTML = `
            <div class="legend-title">üë• Distribui√ß√£o por Fun√ß√£o</div>
            <div class="status-grid">
                <div class="status-section">
                    <div class="legend-title" style="font-size:11px; margin-bottom:5px;">üëë Chefes</div>
                    <div class="status-row">
                        <div class="status-info">
                            <div class="legend-color" style="background:#1d4ed8"></div>
                            <span class="status-label">Satisfat√≥rio</span>
                        </div>
                        <div class="status-count">${percentuais.chefes["Satisfat√≥rio"].percent}%</div>
                    </div>
                    <div class="status-row">
                        <div class="status-info">
                            <div class="legend-color" style="background:#ca8a04"></div>
                            <span class="status-label">Capacitar</span>
                        </div>
                        <div class="status-count">${percentuais.chefes["Capacitar"].percent}%</div>
                    </div>
                    <div class="status-row">
                        <div class="status-info">
                            <div class="legend-color" style="background:#991b1b"></div>
                            <span class="status-label">Avaliar</span>
                        </div>
                        <div class="status-count">${percentuais.chefes["Avaliar"].percent}%</div>
                    </div>
                </div>
                <div class="status-section">
                    <div class="legend-title" style="font-size:11px; margin-bottom:5px;">üë• Assessores</div>
                    <div class="status-row">
                        <div class="status-info">
                            <div class="legend-color" style="background:#1d4ed8"></div>
                            <span class="status-label">Satisfat√≥rio</span>
                        </div>
                        <div class="status-count">${percentuais.assessores["Satisfat√≥rio"].percent}%</div>
                    </div>
                    <div class="status-row">
                        <div class="status-info">
                            <div class="legend-color" style="background:#ca8a04"></div>
                            <span class="status-label">Capacitar</span>
                        </div>
                        <div class="status-count">${percentuais.assessores["Capacitar"].percent}%</div>
                    </div>
                    <div class="status-row">
                        <div class="status-info">
                            <div class="legend-color" style="background:#991b1b"></div>
                            <span class="status-label">Avaliar</span>
                        </div>
                        <div class="status-count">${percentuais.assessores["Avaliar"].percent}%</div>
                    </div>
                </div>
            </div>
        `;
        
        container.appendChild(statusDiv);
        
        return container;
    }

    const map = L.map('map').setView([-15.0, -55.0], 4);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

    // Adicionar legenda customizada com status
    L.Control.StatusLegend = L.Control.extend({
        onAdd: function(map) {
            return criarLegendaComStatus();
        }
    });
    
    L.control.statusLegend = function(opts) {
        return new L.Control.StatusLegend(opts);
    };
    
    L.control.statusLegend({ position: 'bottomleft' }).addTo(map);

    function initResumo() {
        const tbody = document.querySelector('#tabela-resumo tbody');
        tbody.innerHTML = '';
        resumoMapa.forEach(d => {
            const med = (d.c + d.a) / 2;
            const color = getColor(med);
            const marker = L.circleMarker([d.lat, d.lng], { radius: 8, fillColor: color, color: "#fff", weight: 2, fillOpacity: 0.9 }).addTo(map);

            marker.on('mouseover', function (e) {
                const content = `
                    <div class="popup-data">
                        <div class="popup-title">${d.n}</div>
                        Nota Chefe: <b>${d.c.toFixed(1)}</b><br>
                        Nota Assessor: <b>${d.a.toFixed(1)}</b><br>
                        M√©dia Geral: <b>${med.toFixed(1)}</b>
                    </div>`;
                L.popup({ closeButton: false, className: 'custom-popup', offset: [0, -10] })
                    .setLatLng(e.latlng).setContent(content).openOn(map);
            });
            marker.on('mouseout', () => map.closePopup());
            marker.bindTooltip(d.n, { permanent: true, direction: 'top', offset: [0, -8], className: 'label-fixo-cidade' });
            
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${d.n}</td>
                <td><span class="nota-badge" style="background:${getColor(d.c)}">${d.c.toFixed(1)}</span></td>
                <td><span class="nota-badge" style="background:${getColor(d.a)}">${d.a.toFixed(1)}</span></td>`;
            tr.onclick = () => { map.setView([d.lat, d.lng], 6); };
            tbody.appendChild(tr);
        });
    }

    function initDetalhado() {
        const tbody = document.querySelector('#tabela-detalhada tbody');
        tbody.innerHTML = '';
        detComp.forEach(d => {
            const tr = document.createElement('tr');
            let cols = d.c.map(v => `<td><span class="nota-badge" style="background:${getColor(v)}">${v}</span></td>`).join('');
            tr.innerHTML = `<td style="font-weight:600">${d.n}</td><td>${d.u}</td><td>${d.f}</td>
                ${cols}<td><span class="nota-badge" style="background:${getColor(d.med)}">${d.med.toFixed(1)}</span></td>
                <td style="color:#64748b; font-style:italic">${d.obs}</td>`;
            tbody.appendChild(tr);
        });
    }

    let sortOrders = {}; 
    function sortTable(columnIndex, tableId) {
        const table = document.getElementById(tableId);
        const tbody = table.querySelector('tbody');
        const rows = Array.from(tbody.rows);
        if (!sortOrders[tableId + columnIndex]) sortOrders[tableId + columnIndex] = 'asc';
        else sortOrders[tableId + columnIndex] = sortOrders[tableId + columnIndex] === 'asc' ? 'desc' : 'asc';
        const dir = sortOrders[tableId + columnIndex];
        const sortedRows = rows.sort((a, b) => {
            let cellA = a.cells[columnIndex].innerText.trim().replace(',', '.');
            let cellB = b.cells[columnIndex].innerText.trim().replace(',', '.');
            const valA = isNaN(cellA) ? cellA.toLowerCase() : parseFloat(cellA);
            const valB = isNaN(cellB) ? cellB.toLowerCase() : parseFloat(cellB);
            if (valA < valB) return dir === 'asc' ? -1 : 1;
            if (valA > valB) return dir === 'asc' ? 1 : -1;
            return 0;
        });
        tbody.append(...sortedRows);
    }

    function openTab(id, el) {
        document.querySelectorAll('.content-page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-tabs li').forEach(l => l.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
        if(id === 'page-mapa') setTimeout(() => { map.invalidateSize(); }, 200);
    }

    initResumo();
    initDetalhado();
</script>
</body>
</html>
